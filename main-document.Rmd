---
title: "Measurement of sex and gender identity in BRFSS"
author: "Jenine K Harris, Odalis Hernandez"
date: "9/15/2021"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
# TO CREATE ANALYTIC DATA SET, UNCOMMENT AND RUN THIS CODE CHUNK
# bring in files from online BRFSS 2015 to 2018 data
library(haven)
# #
# #
# # # 2015 data
  temp <- tempfile(fileext = ".zip")
  download.file(url  = "https://www.cdc.gov/brfss/annual_data/2015/files/LLCP2015XPT.zip", destfile = temp)
  BRFSS_2015 <- read_xpt(file = temp)
# #
# # 2016 data
 temp <- tempfile(fileext = ".zip")
 download.file(url  = "https://www.cdc.gov/brfss/annual_data/2016/files/LLCP2016XPT.zip", destfile = temp)
 BRFSS_2016 <- read_xpt(file = temp)
#
# # 2017 data
 temp <- tempfile(fileext = ".zip")
 download.file(url  = "https://www.cdc.gov/brfss/annual_data/2017/files/LLCP2017XPT.zip", destfile = temp)
 BRFSS_2017 <- read_xpt(file = temp)
#
# 2018 data
temp <- tempfile(fileext = ".zip")
download.file(url  = "https://www.cdc.gov/brfss/annual_data/2018/files/LLCP2018XPT.zip", destfile = temp)
BRFSS_2018 <- read_xpt(file = temp)

# 2019 data
temp <- tempfile(fileext = ".zip")
download.file(url  = "https://www.cdc.gov/brfss/annual_data/2019/files/LLCP2019XPT.zip", destfile = temp)
BRFSS_2019 <- read_xpt(file = temp)
```

```{r}
#
# # select only the variables to use in the analysis (e.g. changes 300+ variables to only needed for analysis)

#
library(tidyverse)
 BRFSS_2015 <- BRFSS_2015 %>%
   select(SEX, TRNSGNDR, `_RFBING5`, `_RFDRHV5`, DIABETE3,
          PREGNANT, HADMAM, HOWLONG, HADPAP2, LASTPAP2, HPVTEST,
          HPLSTTST, HADHYST2, PROFEXAM, LENGEXAM, PCPSAAD2, PCPSADI1, 
          PCPSARE1, PSATEST1, PSATIME, PCPSARS1, PCPSADE1, PCDMDECN,
          `_DRNKWEK`) %>% 
    mutate(year = "2015")
#
 BRFSS_2016 <- BRFSS_2016 %>%
   select(SEX, `_DRNKWEK`, TRNSGNDR, `_RFDRHV5`, PREGNANT, HADMAM,
          HOWLONG, HADPAP2, LASTPAP2, HPVTEST, HPLSTTST, HADHYST2,
          PROFEXAM, LENGEXAM, PCPSAAD2, PCPSADI1, PCPSARE1, PSATEST1,
          PSATIME, PCPSARS1, PCPSADE1, PCDMDECN, `_RFMAM2Y`, `_MAM5021`, 
          `_RFPAP33`, `_RFPSA21`)%>% 
    mutate(year = "2016")
#
 BRFSS_2017 <- BRFSS_2017 %>%
   select(SEX, `_DRNKWEK`, TRNSGNDR, `_RFDRHV5`, PREGNANT, PFPPRVN2,
          TYPCNTR7, NOBCUSE6)%>% 
    mutate(year = "2017")
#
 BRFSS_2018 <- BRFSS_2018 %>%
  select(SEX1, `_DRNKWEK`,  TRNSGNDR, `_LLCPWT`)%>% 
    mutate(year = "2018")
#
 BRFSS_2019 <- BRFSS_2019 %>%
   select(`_MICHD`, `_SEX`, EDUCA, `_BMI5CAT`, `_DRNKWK1`, EXERANY2, `_RACE`,
          `_AGE80`, `_SMOKER3`, TRNSGNDR, `_LLCPWT`)%>% 
    mutate(year = "2019")
#
# # renamed SEX1 in 2018 to SEX like all the other years
 BRFSS_2018 <- BRFSS_2018 %>%
   rename(SEX = SEX1)
 BRFSS_2019 <- BRFSS_2019 %>%
   rename(SEX = `_SEX`)
#
 # renamed AVEDRNK3 to AVEDRNK2 in 2019 like all the other years
BRFSS_2019 <- BRFSS_2019 %>%
  rename(`_DRNKWEK` = `_DRNKWK1`)



# # combine all years into 1 dataset  
BRFSS_all <- rbind(select(BRFSS_2015, SEX, TRNSGNDR, year), 
                   select(BRFSS_2016, SEX, TRNSGNDR, year),
                   select(BRFSS_2017, SEX, TRNSGNDR, year),
                   select(BRFSS_2018, SEX, TRNSGNDR, year),
                   select(BRFSS_2019, SEX, TRNSGNDR, year))

# save BRFSS_all dataset as a .csv file so every time i want to work with, I just read that file
# in instead of running all steps above
# write.csv(BRFSS_all, file = "brfss_all_wt.csv")
```

```{r}
# add labels
BRFSS_all_clean <- BRFSS_all %>% 
   mutate(SEX = recode_factor(SEX, 
                              '1' = 'male',
                              '2' = 'female')) %>% 
   mutate(TRNSGNDR = recode_factor(TRNSGNDR,
                                   '1' = 'Yes, Transgender, male-to-female',
                                   '2' = 'Yes, Transgender, female to male',
                                   '3' = 'Yes, Transgender, gender nonconforming',
                                   '4' = 'No',
                                   '7' = NA_character_,
                                   '9' = NA_character_)) %>% 
   filter(TRNSGNDR %in% c("Yes, Transgender, male-to-female",
                          "Yes, Transgender, female to male")) %>% 
   droplevels()
# basic table exploring data
table(trans = BRFSS_all_clean$TRNSGNDR, sex = BRFSS_all_clean$SEX, year = BRFSS_all_clean$year)

# library(table1)
# 
# table1(~ year | SEX * TRNSGNDR, data = BRFSS_all_clean)

prop.table(table(trans = BRFSS_all_clean$TRNSGNDR, 
                 sex = BRFSS_all_clean$SEX),
           margin = 2)
```


+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| Question id | Question                                                                                                                                                                                     | Asked of... | Year(s)          |
+=============+==============================================================================================================================================================================================+=============+==================+
| \_DRNKWK1   |                                                                                                                                                                                              | computed    | 2015             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| \_RFBING5   | Binge drinkers (males having five or more drinks on one occasion, females having four or more drinks on one occasion)                                                                        | computed    | 2015             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| \_RFDRHV5   | Heavy drinkers (adult men having more than 14 drinks per week and adult women having more than 7 drinks per week)                                                                            | computed    | 2015, 2016, 2017 |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| DIABETE3    | (Ever told) you have diabetes (If "Yes" and respondent is female, ask "Was this only when you were pregnant?". If Respondent says pre-diabetes or borderline diabetes, use response code 4.) | female      | 2015       2018      |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PREGNANT    | To your knowledge, are you now pregnant?                                                                                                                                                     | female      | 2015, 2016, 2017, 2018  |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| HADMAM      | A mammogram is an x-ray of each breast to look for breast cancer. Have you ever had a mammogram?                                                                                             | female      | 2015, 2016, 2018     |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| HOWLONG     | How long has it been since you had your last mammogram?                                                                                                                                      | female      | 2015, 2016, 2018      |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| HADPAP2     | A Pap test is a test for cancer of the cervix. Have you ever had a Pap test?                                                                                                                 | female      | 2015, 2016, 2018    |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| LASTPAP2    | How long has it been since you had your last Pap test?                                                                                                                                       | female      | 2015, 2016, 2018    |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| HPVTEST     | An HPV test is sometimes given with the Pap test for cervical cancer screening. Have you ever had an HPV test?                                                                               | female      | 2015, 2016, 2018   |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| HPLSTTST    | How long has it been since you had your last HPV test?                                                                                                                                       | female      | 2015, 2016, 2018     |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| HADHYST2    | Have you had a hysterectomy? (A hysterectomy is an operation to remove the uterus (womb).)                                                                                                   | female      | 2015, 2016, 2018   |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PROFEXAM    | A clinical breast exam is when a doctor, nurse, or other health professional feels the breast for lumps. Have you ever had a clinical breast exam?                                           | female      | 2015, 2016       |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| LENGEXAM    | How long has it been since your last breast exam?                                                                                                                                            | female      | 2015, 2016       |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PCPSAAD2    | Has a doctor, nurse, or other health professional EVER talked with you about the advantages of the PSA test?                                                                                 | male        | 2015, 2016       |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
---------------------+-------------+------------------+
| PCPSAAD3    | Has a doctor, nurse, or other health professional EVER talked with you about the advantages of the PSA test?                                                                                 | male        | 2018      |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PCPSADI1    | Has a doctor, nurse, or other health professional EVER talked with you about the disadvantages of the PSA test?                                                                              | male        | 2015, 2016, 2018     |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PCPSARE1    | Has a doctor, nurse, or other health professional EVER recommended that you have a PSA test?                                                                                                 | male        | 2015, 2016, 2018     |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PSATEST1    | Have you EVER HAD a PSA test?                                                                                                                                                                | male        | 2015, 2016, 2018       |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PSATIME     | How long has it been since you had your last PSA test?                                                                                                                                       | male        | 2015, 2016, 2018       |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PCPSARS1    | What was the MAIN reason you had this PSA test -- was it ...?                                                                                                                                | male        | 2015, 2016, 2018       |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PCPSADE1    | Which of the following best describes the decision to have the PSA test done?                                                                                                                | male        | 2015, 2016       |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PCDMDECN    | Who made the decision with you? (Mark all that apply)                                                                                                                                        | male        | 2015, 2016       |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| \_RFMAM2Y\  | Women respondents aged 40+ who have had a mammogram in the past two years                                                                                                                    | computed    | 2016             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| \_MAM5021\  | Women respondents aged 50-74 who have had a mammogram in the past two years                                                                                                                  | computed    | 2016             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| \_RFPAP33\  | Women respondents aged 21-65 who have had a pap test in the past three years                                                                                                                 | computed    | 2016             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| \_RFPSA21\  | Male respondents aged 40+ who have had a PSA test in the past 2 years                                                                                                                        | computed    | 2016             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| PFPPRVN2\   | Did you or your partner do anything the last time you had sex to keep you from getting pregnant?                                                                                             | female      | 2017             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| TYPCNTR7\   | What did you or your partner do the last time you had sex to keep you from getting pregnant?                                                                                                 | female      | 2017             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
| NOBCUSE6\   | What was your main reason for not doing anything the last time you had sex to keep you from getting pregnant?                                                                                | female      | 2017             |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+
---------------------+-------------+------------------+
| CNCRTYP1\   | With your most recent diagnoses of cancer, what type of cancer was it?
                      | female      | 2018           |
+-------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------+------------------+



